import unittest
import pathlib as pl
from gpt_app import Gpt_Api
from app_config import API_KEY, LIMIT_KEY, FALSE_KEY

class Test_Gpt_Api( unittest.TestCase ):

    def test_load_image(self):
        ''' function to test whether file to be read is present at path '''
        path = "gpt_image.avif"
        self.assertTrue(pl.Path(path).resolve().is_file())

    def test_ui_working(self):
        ''' check total ui working '''
        api = Gpt_Api()
        api.user_input.value = "how does chat gpt work?"
        api.button_send.click()

    def test_chat_completion_api(self):
        ''' function to test whether the api is working  '''
        api = Gpt_Api()

        ## we provide a rate limit exceeded key and assert the response
        api.key = LIMIT_KEY
        prompt = "tell me the names of 7 wonders of the world"
        response = api.get_completion(prompt)
        expected_res = "OpenAI API request exceeded rate limit: You exceeded your current quota, please check your plan and billing details."
        self.assertEqual(response, expected_res)

        ## by providing invalid api key, an authentication error must be raised
        api.key = FALSE_KEY
        prompt = "tell me the names of 7 wonders of the world"
        response = api.get_completion(prompt)
        expected_res = "Authentication error with OpenAI API"
        self.assertIn(expected_res, response)

        ## simply asserting responses
        api.key = API_KEY
        prompt = "whats 5+4 in one word?"
        response = api.get_completion(prompt)
        expected_res = "Nine nine. nine Nine."
        self.assertIn(response, expected_res)

        ## unable to undestand question
        api.key = API_KEY
        prompt = "what si sjdbf this da khy yu shi chan?"
        response = api.get_completion(prompt)
        expected_res = "understand"
        self.assertIn(expected_res, response)

        ## incomplete sentence
        api.key = API_KEY
        prompt = ""
        response = api.get_completion(prompt)
        if ("incomplete" not in response) or ("understand" not in response):
            print(response)
            raise Exception('did not expect this error')

        ## assert invalid request by giving too mmuch tokens
        api.key = API_KEY
        prompt="You are probably familiar with the idea that transitions may be needed between paragraphs or sections in a paper (see our handout on transitions). Sometimes they are also helpful within the body of a single paragraph. Within a paragraph, transitions are often single words or short phrases that help to establish relationships between ideas and to create a logical progression of those ideas in a paragraph. This is especially likely to be true within paragraphs that discuss multiple examples. Let’s take a look at a version of our piranha paragraph that uses transitions to orient the reader: Although most people consider piranhas to be quite dangerous, they are, except in two main situations, entirely harmless. Piranhas rarely feed on large animals; they eat smaller fish and aquatic plants. When confronted with humans, piranhas’ instinct is to flee, not attack. But there are two situations in which a piranha bite is likely. The first is when a frightened piranha is lifted out of the water—for example, if it has been caught in a fishing net. The second is when the water level in pools where piranhas are living falls too low. A large number of fish may be trapped in a single pool, and if they are hungry, they may attack anything that enters the water. We consulted these works while writing this handout. This is not a comprehensive list of resources on the handout’s topic, and we encourage you to do your own research to find additional publications. Please do not use this list as a model for the format of your own reference list, as it may not match the citation style you are using. For guidance on formatting citations, please see the UNC Libraries citation tutorial. We revise these tips periodically and welcome feedback. Although most people consider piranhas to be quite dangerous, they are, for the most part, entirely harmless. Piranhas rarely feed on large animals; they eat smaller fish and aquatic plants. When confronted with humans, piranhas’ first instinct is to flee, not attack. Their fear of humans makes sense. Far more piranhas are eaten by people than people are eaten by piranhas. If the fish are well-fed, they won’t bite humans. The cow is a sacred animal in Hinduism and is worshipped as a goddess. She is considered to be the source of all life and is revered as a symbol of fertility, motherhood, and abundance. The cow is also a symbol of selfless service and is often seen as a provider of milk and other dairy products, which are essential to the human diet. In many Hindu temples, the cow is given a special place of honor and is often garlanded and decorated with flowers. In some Hindu communities, the cow is given a special place in the home, and is given a special diet and care. In addition, the cow is often given special privileges, such as the right to graze in certain areas, and to be given special treatment during religious ceremonies. Cow dung is often used in religious worship. In rural India, cows supplement a family’s income and nutritional needs by giving milk and cow dung as fuel. Cows have been an integral part of human civilization since their inception. Therefore the maintenance cost and high production value have made cows one of man’s most favored livestock. The Cow is a very famous and also important domestic animal. It is known as the “Cow is our Mother” in India. Kids are generally assigned to write essays on cows in their classroom or for exams. So, various types of cow essays are provided here with different words limit for your school-going kids and children. The Cow is a very useful pet animal. A successful domestic animal kept by people at home for many purposes. It is a four-footed female animal having a large body, two horns, two eyes, two ears, one nose, one mouth, one head, a big back, and also a stomach. She eats a large amount of food at one time. She gives us milk to make us healthy and strong. It keeps us away from diseases and infections by increasing our immunity power. She is a sacred animal and worshipped in India like a Goddess. She has given the status of Mother in Hindu society. It is a very famous milk-giving animal useful for many purposes. In the Hindu religion, it considered Gau Dan the biggest Dan in the world. The Cow is a sacred animal to Hindus. Cow gives us many benefits throughout her life and even after her death. She gives us milk, calf (either female Cow or male cow ox), co-dung, gau-mutra while living, and lots of leather and strong bones after death. She eats green grasses, foods, grains, hay, and other eatable things. Cow uses her one pair of strong, tight horns to attack the people as a defense organ to save her child. She also uses her tail sometimes to attack. She has long hair on the tip of her tail. Cow also has small hair on her body and uses them to frighten away the flies. She has highly helped in human lives for years in many ways. She has been the reason for our healthy lives for thousands of years. Therefore the origin of the Cow on the earth for nourishing human lives has a great history behind it. We all should know her importance and necessity in our lives and respect her forever. We should never hurt cows and give them proper food and water timely. Cow differs in colour, size, and also shape from region to region. Some cows are small, big, white, or black, and some are of mixed colour. Cow milk given high status in society as it benefits us. She gives birth to a small calf after 12 months. She does not provide any practice for her child to walk or run; they start walking and running just after birth. Her calf drinks her milk for some days or months and starts eating food like her. However the Cow is a very sacred animal for all Hindus. It is a big domestic animal, having four legs, tears, two ears, two eyes, one nose, one mouth, one head, and also a wide back. The Cow is a domestic and very successful animal. It is of great importance for the people of the Hindu religion. A most important pet animal kept by almost all people of Hindu rate female animal who gives us milk daily two times, in the morning and evening. Some cow gives milk three times a day according to their diet, and the Hindu people consider cow a mother called the Gau Mata. Hindu people respect Cows very much and do worship them. Cow milk offered to God during pooja and Katha. It also used for Abhishek of the God and Goddess statue during festivals and pooja. Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.Cows differ in their shapes, sizes, and colours. The food, grains, green grasses, fodder, and other eatable things. Generally, she used to grazing green grasses in the fields. Cow milk used worldwide to prepare several eatable items and things. We can make curd, dahi, whey, cheese, ghee, butter, various types of sweets, khoya, paneer, and so many things from cow milk. Cow milk is easily digestible and can eaten by patients with digestive disorders. Cow milk makes us strong and healthy. It prevents us from various types of infections and diseases. It helps in increasing our immunity power. Cow milk makes our minds sharp and also memory strong if we drink it regularly.She eats green grasses, grains, foods, hay, fodder, and other things. Cow chews her food well in the mouth and then swallows. She has one pair of the big horns as a defense organ while saving her child or own. Sometimes she attacks the people by making her horns parallel to the ground. She gives birth to a nice calf after nourishing him for 12 months in her womb. She gives birth to a strong ox or fertile female cow who again starts giving milk after a few years. However Hindu people use ox for plowing the fields, drawing carts, and pulling heavy loads in many households. Ox is the real wealth for the farmers as they help the world works.The cow is a sacred animal in Indian society. It is revered as a symbol of life and fertility and is associated with the goddesses Lakshmi and Saraswati. The cow is also considered a source of food and nutrition, and its milk is used in religious ceremonies."
        response = api.get_completion(prompt)
        expected_res = "Invalid request to OpenAI API: This model's maximum context length is 4097 tokens. However, your messages resulted in 4903 tokens. Please reduce the length of the messages."
        self.assertEqual(response, expected_res)

if __name__ == "__main__":
    unittest.main()